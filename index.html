<!-- Floating Chatbot Launcher -->
<div id="chatbot-container" style="position: fixed; bottom: 20px; left: 20px; z-index: 9999; font-family: sans-serif;">
  <!-- Chat Icon -->
  <div id="chatbot-icon" style="width: 60px; height: 60px; background-color: #7c3aed; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 12px rgba(0,0,0,0.2); cursor: pointer;">
    <span style="font-size: 28px; color: white;">üí¨</span>
  </div>

  <!-- Chat Window -->
  <div id="chatbot-window" style="display: none; width: 340px; height: 450px; background: white; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); overflow: hidden; flex-direction: column; position: absolute; bottom: 70px; left: 0;">
    <div style="background-color: #7c3aed; color: white; padding: 14px; font-weight: bold; display: flex; justify-content: space-between;">
      <span>AI Assistant</span>
      <span style="font-size: 12px;"><span style="color: #0f0;">‚óè</span> Online</span>
    </div>
    <div id="chat-messages" style="flex: 1; padding: 12px; overflow-y: auto; font-size: 14px;"></div>
    <div style="padding: 10px; display: flex; align-items: center; border-top: 1px solid #eee;">
      <input id="chat-input" type="text" placeholder="Type a message..." style="flex: 1; padding: 8px 12px; border-radius: 20px; border: 1px solid #ccc; font-size: 14px; outline: none;" />
      <button id="send-btn" style="margin-left: 8px; border: none; background: transparent; font-size: 18px; cursor: pointer;">üì§</button>
    </div>
  </div>
</div>

<style>
  #chat-messages div {
    margin-bottom: 8px;
    padding: 6px 10px;
    background: #f3f4f6;
    border-radius: 8px;
    max-width: 85%;
    clear: both;
  }

  #chat-messages .user {
    background: #e0e7ff;
    float: right;
    text-align: right;
  }

  #chat-messages .bot {
    background: #f9fafb;
    float: left;
  }

  @media (max-width: 500px) {
    #chatbot-window {
      width: 90vw;
      height: 75vh;
    }
  }
</style>

<script>
  const icon = document.getElementById("chatbot-icon");
  const windowBox = document.getElementById("chatbot-window");
  const input = document.getElementById("chat-input");
  const messages = document.getElementById("chat-messages");
  const sendBtn = document.getElementById("send-btn");

  icon.addEventListener("click", () => {
    windowBox.style.display = windowBox.style.display === "none" ? "flex" : "none";
  });

  input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") sendMessage();
  });

  sendBtn.addEventListener("click", sendMessage);

  function addMessage(sender, text) {
    const bubble = document.createElement("div");
    bubble.className = sender === "You" ? "user" : "bot";
    bubble.textContent = `${sender}: ${text}`;
    messages.appendChild(bubble);
    messages.scrollTop = messages.scrollHeight;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    addMessage("You", text);
    input.value = "";
    try {
      const res = await fetch("https://chatbot-backend-z8e4.onrender.com/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
      });
      const data = await res.json();
      addMessage("Bot", data.reply || "Sorry, no response.");
    } catch {
      addMessage("Bot", "‚ö†Ô∏è Could not connect.");
    }
  }
</script>
